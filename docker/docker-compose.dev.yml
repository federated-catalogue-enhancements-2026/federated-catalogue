# Development override for the Federated Catalogue Docker stack.
# Use ./dev.sh for convenient access to these workflows.
#
# Workflow 1 — Infrastructure only (run fc-server locally):
#   ./dev.sh up
#   ./dev.sh run
#
# Workflow 2 — Containerized server with hot-reload:
#   ./dev.sh build && ./dev.sh watch
#   # Edit code, then: ./dev.sh build
#   # The server container restarts automatically when the JAR changes.
#
# Workflow 3 — Full stack without hot-reload (omit this file):
#   ./dev.sh full

services:
  server:
    # Use an entrypoint that finds and runs the JAR from the synced location.
    # This avoids the "path also declared by bind mount" warning when using watch.
    entrypoint: ["sh", "-c", "java -jar /app/fc-service-server-*.jar"]
    environment:
      SPRING_PROFILES_ACTIVE: dev
    develop:
      watch:
        # Sync the entire target directory and restart when the JAR changes.
        # We watch the target directory and filter to just trigger on JAR changes.
        - action: sync+restart
          path: ../fc-service-server/target/
          target: /app/
          ignore:
            - "**/*.jar.original"
            - classes/
            - test-classes/
            - maven-status/
            - maven-archiver/
            - generated-sources/
            - generated-test-sources/
            - surefire/
            - surefire-reports/

